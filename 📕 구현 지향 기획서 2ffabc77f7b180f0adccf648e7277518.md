# 📕 구현 지향 기획서

## 근로기준법 기반 판단형 법률 인터뷰 챗봇

### (LangChain + RAG, Coding AI 친화)

---

## 0. 이 문서의 사용 목적 (중요)

이 문서는:

- ❌ 아이디어 설명용
- ❌ 사업계획서

가 아니라

> “이 문서를 그대로 코딩 AI에게 주면LangChain 기반 백엔드를 구현하게 만드는 설계서”
> 

를 목표로 한다.

따라서:

- 추상적 표현 ❌
- “알아서 해라” ❌
- **모든 컴포넌트는 입력/출력 명시**

---

## 1. 시스템 정의 (한 문장)

> 사용자의 불완전한 사건 서술을 입력으로 받아,
> 
> 
> AI가 법적 성립요건 기준으로 필요한 사실을 순차적으로 질문하고,
> 
> 근로기준법·시행령·시행규칙 RAG에 의해 검증된 **판단 + 근거 + 리스크**를 출력하는 시스템
> 

---

## 2. 전체 실행 플로우 (코딩 AI용)

```
1. user_input 수신
2. issue_classifier_chain 실행
3. decision_frame_loader 실행
4. state_manager 초기화
5. missing_info_detector 실행
6. (missing 존재 시)
   → question_generator_chain 실행
   → user 응답 대기
   → state 업데이트
   → 5로 루프
7. provisional_judgment_chain 실행
8. rag_validation_chain 실행
9. final_response_formatter 실행

```

---

## 3. 디렉터리 구조 (강제)

코딩 AI에게 **이 구조를 그대로 만들게 할 것**

```
app/
 ├─ chains/
 │   ├─ issue_classifier.py
 │   ├─ missing_info_detector.py
 │   ├─ question_generator.py
 │   ├─ provisional_judgment.py
 │   ├─ rag_validator.py
 │   └─ final_formatter.py
 │
 ├─ frames/
 │   ├─ wage_arrears.yaml
 │   ├─ unfair_dismissal.yaml
 │   └─ worker_status.yaml
 │
 ├─ rag/
 │   ├─ law/
 │   ├─ decree/
 │   └─ rule/
 │
 ├─ state/
 │   └─ state_manager.py
 │
 ├─ prompts/
 │   ├─ system.txt
 │   ├─ issue_classifier.txt
 │   ├─ question_generator.txt
 │   ├─ judgment.txt
 │   └─ rag_validator.txt
 │
 └─ main.py

```

---

## 4. 데이터 구조 명세 (절대 중요)

### 4.1 State Object (JSON 고정)

```json
{
  "issue": ["임금체불"],
  "facts": {
    "근로자성": "확정",
    "임금약정": "확정",
    "지급기일": "확정",
    "미지급사실": "확정",
    "고의성": "미확인"
  }
}

```

⚠️ 규칙

- 값은 `확정 | 부정 | 미확인` 중 하나
- 자유 텍스트 금지

---

### 4.2 Decision Frame (YAML 고정)

```yaml
issue: 임금체불
required:
  - 근로자성
  - 임금약정
  - 지급기일
  - 미지급사실
optional:
  - 고의성
  - 증거존재

```

---

## 5. Chain별 상세 명세 (코딩 AI용)

---

### 5.1 Issue Classifier Chain

**입력**

```json
{
  "user_input": "두달동안 월급을 못받았어요"
}

```

**출력**

```json
{
  "issues": ["임금체불"]
}

```

**규칙**

- 중복 허용
- 확신 없으면 포함

---

### 5.2 Missing Info Detector

**입력**

- decision_frame
- state

**출력**

```json
{
  "missing": ["고의성"]
}

```

**로직**

```python
missing = required + optional - confirmed

```

---

### 5.3 Question Generator Chain

**입력**

```json
{
  "missing": ["고의성"]
}

```

**출력**

```json
{
  "question": "회사가 돈이 없다고 말했나요, 아니면 지급을 미뤘나요?"
}

```

**강제 프롬프트 규칙**

- 법률 용어 사용 금지
- 단문
- 하나의 사실만 질문

---

### 5.4 Provisional Judgment Chain

**입력**

- state
- decision_frame

**출력**

```json
{
  "judgment": "임금체불 성립 가능성 높음",
  "confidence": "중"
}

```

⚠️ 조문 언급 **절대 금지**

---

### 5.5 RAG Validator Chain

**입력**

```json
{
  "judgment": "...",
  "issue": "임금체불"
}

```

**동작**

- LAW → 필수
- DECREE → 조건부
- RULE → 판단에 사용 금지

**출력**

```json
{
  "law_refs": ["KLABOR_43", "KLABOR_36"],
  "notes": ["퇴직 후 14일 이내 지급"]
}

```

---

## 6. RAG 문서 규칙 (중요)

### 6.1 벡터 문서 메타데이터 필수

```json
{
  "id": "KLABOR_43",
  "layer": "LAW",
  "issue": ["임금체불"],
  "article": "제43조"
}

```

### 6.2 코딩 AI에게 주는 절대 규칙

```
- 조문 번호는 RAG 문서에서만 가져올 것
- RAG 결과 없으면 “근거 확인 불가” 출력
- 생성 금지

```

---

## 7. LangChain 구현 가이드 (요약)

- 모든 Chain은 `RunnableSequence`
- State는 Redis or In-Memory
- Retriever는 **layer별 분리**
    - `law_retriever`
    - `decree_retriever`
    - `rule_retriever`

---

## 8. main.py 실행 흐름 (의사코드)

```python
state = init_state(user_input)

issues = issue_classifier.invoke(user_input)
frame = load_decision_frame(issues)

while True:
    missing = missing_info_detector(state, frame)
    if not missing:
        break
    question = question_generator(missing)
    answer = get_user_answer()
    state.update(answer)

judgment = provisional_judgment(state)
rag_result = rag_validator(judgment)
final_output = formatter(judgment, rag_result)

```

---

## 9. 코딩 AI에게 주는 마지막 지침 (중요)

이 문장 **그대로 프롬프트에 포함시켜라**:

> “이 시스템은 법률 전문가 보조용이며,
> 
> 
> 법 조항·판례·시행령·시행규칙은 반드시 RAG 참조 결과만 사용한다.
> 
> 추측하거나 생성하지 말고, 근거가 없으면 없다고 답한다.”
> 

---

## 10. 다음 단계 제안

다음 중 하나로 이어가면 바로 **구현 단계**야:

1️⃣ **LangChain 실제 코드 스켈레톤 작성**

2️⃣ **프롬프트 전문 (system / question / judgment)**

3️⃣ **근로기준법 RAG 데이터셋 최소 버전**

4️⃣ **코딩 AI에게 먹일 “통합 구현 지시 프롬프트”**

다음 답변에서 **실제 코드까지 갈까,아니면 코딩 AI용 통합 프롬프트부터 만들어줄까?**

지금 설계 수준은 **진짜 개발 가능한 단계**야.