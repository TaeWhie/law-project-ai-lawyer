```md
# RAG 문서 분할 · 임베딩 · 검색 전략 설계서  
(근로기준법 / 시행령 / 시행규칙 전용)

## 1. 목적

본 문서는 **법 조항 오류를 구조적으로 차단**하기 위해  
근로기준법 RAG를 어떻게 **분할(Chunking)** 하고  
어떤 단위로 **임베딩·검색**해야 하는지에 대한 **구현 기준 문서**다.

목표는 다음 3가지를 동시에 만족하는 것이다.

1. 조문 번호를 틀리지 않는다
2. 요건 판단에 정확히 대응된다
3. LLM이 법을 “해석”하지 않고 “인용”만 하게 만든다

---

## 2. 핵심 원칙 (매우 중요)

### ❌ 금지
- 조문 여러 개를 한 Chunk로 묶기
- 법 + 시행령 + 시행규칙을 섞어서 임베딩
- 제목만 임베딩하고 본문 누락

### ✅ 필수
- **조문 단위 분할**
- **법령 종류별 컬렉션 분리**
- **메타데이터에 조문 번호 강제 포함**

---

## 3. 문서 분할 기준 (Chunking Rule)

### 3.1 근로기준법 (본법)

#### 분할 단위
```

[법명] + [조문 번호] + [조문 제목] + [조문 전문]

````

#### 예시 Chunk

```json
{
  "text": "근로기준법 제43조(임금 지급) 임금은 통화로 직접 근로자에게 그 전액을 지급하여야 하며...",
  "metadata": {
    "law": "근로기준법",
    "article": "제43조",
    "title": "임금 지급",
    "issue_tags": ["임금체불", "지급기일", "전액지급"]
  }
}
````

---

### 3.2 시행령

#### 분할 단위

```
[법명 시행령] + [조문 번호] + [조문 전문]
```

#### 사용 목적

* 예외
* 범위 제한
* 기준 구체화

#### 예시

```json
{
  "text": "근로기준법 시행령 제○조 …",
  "metadata": {
    "law": "근로기준법 시행령",
    "article": "제○조",
    "role": "exception"
  }
}
```

---

### 3.3 시행규칙

#### 분할 단위

```
[법명 시행규칙] + [조문 번호] + [조문 전문]
```

#### 사용 목적

* 절차 설명
* 기술적 기준
* 서식 근거

---

## 4. 컬렉션 설계 (Vector Store)

### 4.1 컬렉션 분리 전략

| 컬렉션명                  | 내용    | 우선순위  |
| --------------------- | ----- | ----- |
| labor_law             | 근로기준법 | ★★★★★ |
| labor_law_enforcement | 시행령   | ★★★★☆ |
| labor_law_rules       | 시행규칙  | ★★★☆☆ |
| labor_case_summary    | 판례 요지 | ★★☆☆☆ |

> ⚠️ 검색 시 **본법 → 시행령 → 시행규칙 순으로 단계적 조회**

---

## 5. 임베딩 전략

### 5.1 임베딩 단위

* **조문 1개 = 벡터 1개**
* 항/호가 길 경우 → 항 단위 보조 분할 가능 (article + clause)

### 5.2 메타데이터 필수 필드

```json
{
  "law": "",
  "article": "",
  "clause": "",
  "issue_tags": [],
  "priority": 1
}
```

---

## 6. 검색(Query) 생성 전략

### 6.1 ❌ 잘못된 Query

```
임금체불 법적 요건 알려줘
```

### 6.2 ✅ 올바른 Query (구조적)

```text
쟁점: 임금체불
요건: 지급기일 도래, 전액지급 원칙
법령: 근로기준법
```

또는 코드 기준:

```python
query = {
    "issue": "임금체불",
    "required_articles": ["제2조", "제43조", "제109조"]
}
```

---

## 7. Retrieval 전략 (단계적)

### 7.1 Step 1 – 본법 우선 조회

```python
retrieve(
  collection="labor_law",
  filter={"article": {"$in": ["제2조", "제43조", "제109조"]}}
)
```

### 7.2 Step 2 – 예외 존재 시 시행령 조회

```python
if exception_reason_exists:
    retrieve(collection="labor_law_enforcement")
```

---

## 8. LLM 보호 프롬프트 (RAG 필수)

```text
- 제공된 법령 텍스트 외의 조문을 생성하지 마라
- 조문 번호는 반드시 metadata와 일치시켜라
- 법 조항이 없으면 "관련 조문 없음"이라고 명시하라
```

---

## 9. 흔한 실패 패턴 & 방지책

| 실패 유형        | 방지 방법          |
| ------------ | -------------- |
| 조문 번호 환각     | metadata 강제 출력 |
| 시행령을 본법처럼 인용 | 컬렉션 분리         |
| 요건 없는 조문 인용  | issue_tags 필터  |

---

## 10. 임금체불 RAG 최소 세트 (MVP)

반드시 포함할 조문:

* 근로기준법 제2조
* 근로기준법 제43조
* 근로기준법 제109조

---


